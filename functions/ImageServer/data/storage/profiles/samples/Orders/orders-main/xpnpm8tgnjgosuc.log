{"type":"operationStart","subtype":"profile","data":{"_id":"0TyWAB0pG59KZbSm","timestamp":"2024-06-25T14:14:06.416Z","state":"queued","mode":"full","creationDate":"2024-06-25T14:14:06.417Z","modificationDate":"2024-06-25T14:14:06.417Z","shortid":"ES9qU2B","$entitySet":"profiles"},"doDiffs":false,"timestamp":1719324846417,"id":"ej1upjs70y696gn","previousOperationId":null,"operationId":"swdp3fco0zxjn4d"}
{"type":"log","level":"info","message":"Render request 5 queued for execution and waiting for available worker","previousOperationId":"swdp3fco0zxjn4d","timestamp":1719324846417,"id":"zzrrrwv5cfik1pl"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"swdp3fco0zxjn4d","timestamp":1719324846423,"id":"4b9maepmt2zrk14","previousEventId":"ej1upjs70y696gn","operationId":"b0njou7416il2we","res":{"content":null,"meta":{"diff":"Index: resMeta\n===================================================================\n--- resMeta\n+++ resMeta\n@@ -1,0 +1,1 @@\n\\ No newline at end of file\n+{}\n\\ No newline at end of file\n"}},"req":{"diff":"Index: req\n===================================================================\n--- req\n+++ req\n@@ -1,0 +1,47 @@\n\\ No newline at end of file\n+{\n+  \"template\": {\n+    \"name\": \"orders-main\",\n+    \"recipe\": \"chrome-pdf\",\n+    \"shortid\": \"HJH11D83ce\",\n+    \"folder\": {\n+      \"shortid\": \"erkLzi\"\n+    },\n+    \"engine\": \"handlebars\",\n+    \"scripts\": [\n+      {\n+        \"__isDirty\": false,\n+        \"__isLoaded\": false,\n+        \"__entitySet\": \"scripts\",\n+        \"_id\": \"N0o61dY4imw4dlgi\",\n+        \"name\": \"orders-script\",\n+        \"shortid\": \"BJX1Jw82ce\",\n+        \"folder\": {\n+          \"shortid\": \"erkLzi\"\n+        }\n+      }\n+    ],\n+    \"chrome\": {\n+      \"printBackground\": true,\n+      \"marginTop\": \"4cm\",\n+      \"marginRight\": \"1.5cm\",\n+      \"marginBottom\": \"1.5cm\",\n+      \"marginLeft\": \"1.5cm\",\n+      \"waitForJS\": false,\n+      \"headerTemplate\": \"\",\n+      \"footerTemplate\": \"\"\n+    },\n+    \"pdfOperations\": [\n+      {\n+        \"type\": \"merge\",\n+        \"templateShortid\": \"SJVbqZr9f\",\n+        \"renderForEveryPage\": false,\n+        \"mergeWholeDocument\": true\n+      }\n+    ],\n+    \"content\": \"<!--\\nMore complex example demonstrating advanced features like\\n- using custom server script to fetch remote data\\n- using custom modules in safe sandbox\\n- painting a chart\\n- using global helpers\\n- merging custom dynamic header document\\n\\nNote: This example requires jsreport to be configured with\\n{ \\\"trustUserCode\\\": true } or\\n{ \\\"sandbox\\\": { \\\"allowedModules\\\": [\\\"https\\\"] } }\\n!-->\\n<html>\\n  <head>\\n    <meta content=\\\"text/html; charset=utf-8\\\" http-equiv=\\\"Content-Type\\\">\\n    <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/metro/4.1.5/css/metro.min.css\\\">\\n    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js'></script>\\n  </head>\\n  <body>\\n    {{#each orders}}\\n        <!-- add hiden information to the page which is resolved in OrdersHeader template\\n             during the pdf merge. See the docs about pdf utils extension for more details. -->\\n        {{{pdfCreatePagesGroup country}}}\\n        <canvas id='orders{{country}}' style=\\\"margin-bottom:30px\\\"></canvas>\\n        <table class='table striped'>\\n            <thead>\\n                <tr>\\n                    <th>OrderID</th>\\n                    <th>ShipAddress</th>\\n                    <th>ShipCity</th>\\n                    <th>ShipCountry</th>\\n                </tr>\\n            </thead>\\n            <tbody>\\n                {{#each rows}}\\n                <tr>\\n                    <td>{{OrderID}}</td>\\n                    <td>{{ShipAddress}}</td>\\n                    <td>{{ShipCity}}</td>\\n                    <td>{{ShipCountry}}</td>\\n                </tr>\\n                {{/each}}\\n            </tbody>\\n        </table>\\n\\n        <script>\\n            // convert data into js string using function from asset global helpers.js\\n            // this results into something like var data = { \\\"a\\\": \\\"foo\\\" }\\n            // which gets afterwards interpreted in chrome into object\\n            var data = {{{toJS accumulated}}}\\n\\n            Chart.defaults.global.legend.display = false;\\n\\n            new Chart(orders{{country}}.getContext(\\\"2d\\\"), {\\n                type: 'bar',\\n                data: {\\n                    labels: Object.keys(data),\\n                    datasets: [{\\n                        fillColor: 'blue',\\n                        label: \\\"Orders in time\\\",\\n                        backgroundColor: \\\"rgba(27,161,226,0.2)\\\",\\n                        borderColor: \\\"rgba(27,161,226,1)\\\",\\n                        borderWidth: 1,\\n                        hoverBackgroundColor: \\\"rgba(27,161,226,0.4)\\\",\\n                        hoverBorderColor: \\\"rgba(27,161,226,1)\\\",\\n                        data: Object.keys(data).map(function (o) {\\n                            return data[o].value;\\n                        })\\n                    }]\\n                },\\n                options: {\\n                    animation: {\\n                        duration: 0\\n                    }\\n                }\\n            });\\n        </script>\\n        <div style='page-break-after: always;'>\\n        </div>\\n    {{/each}}\\n  </body>\\n</html>\\n\",\n+    \"helpers\": \"\",\n+    \"creationDate\": \"2024-06-25T14:11:24.429Z\",\n+    \"modificationDate\": \"2024-06-25T14:11:24.429Z\"\n+  },\n+  \"data\": {}\n+}\n\\ No newline at end of file\n"}}
{"type":"log","timestamp":1719324846425,"level":"info","message":"Starting rendering request 5","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"zagkfebkgq7gh4n","previousOperationId":"b0njou7416il2we"}
{"type":"log","timestamp":1719324846425,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"1l69niufdt8fkgd","previousOperationId":"b0njou7416il2we"}
{"type":"log","timestamp":1719324846426,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"6i9kplayk3y6l2m","previousOperationId":"b0njou7416il2we"}
{"type":"log","timestamp":1719324846428,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"epnv2424arjlg4g","previousOperationId":"b0njou7416il2we"}
{"type":"log","timestamp":1719324846436,"level":"warn","message":"Error when processing render request 5\n(because) error when evaluating custom script /samples/Orders/orders-script\nrequire of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n\nError: require of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n  at sandboxRequire (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:64:19)\n  at Object.require (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n  at eval (sandbox.js:2:15)\n  at async run (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:214:14)\n  at async executeScript (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:129:12)\n  at async Scripts._runScript (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n  at async Scripts.handleBeforeRender (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n  at async ListenerCollection.fire (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n  at async beforeRender (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)\n  at async WorkerReporter._render (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:147:7)\n  at async /Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/reporter.js:232:24\n  at async processAndResponse (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/advanced-workers/lib/workerHandler.js:41:17)","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"e9n787nsgd7gow5","previousOperationId":"b0njou7416il2we"}
{"type":"log","timestamp":1719324846436,"level":"warn","message":"Rendering request 5 finished with error in 20 ms","meta":{"rootId":"xpnpm8tgnjgosuc","id":"xpnpm8tgnjgosuc"},"id":"xnhiq5j0wrqnnlo","previousOperationId":"b0njou7416il2we"}
{"type":"error","timestamp":1719324846439,"statusCode":400,"weak":true,"decoratedSuffix":"\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n","entity":{"shortid":"BJX1Jw82ce","name":"orders-script","content":"// server side script fetching remote data and preparing report data source\nconst https = require('https');\n\n// call remote http rest api\nfunction fetchOrders() {\n    return new Promise((resolve, reject) => {\n        https.get('https://services.odata.org/V4/Northwind/Northwind.svc/Orders',\n        (result) => {\n            var str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str).value));\n        });\n    })\n}\n\n// group the data for report\nasync function prepareDataSource() {\n    const orders = await fetchOrders()\n    const ordersByShipCountry = orders.reduce((a, v) => {\n        a[v.ShipCountry] = a[v.ShipCountry] || []\n        a[v.ShipCountry].push(v)\n        return a\n    }, {})\n\n    return Object.keys(ordersByShipCountry).map((country) => {\n        const ordersInCountry = ordersByShipCountry[country]\n\n        const accumulated = {}\n\n        ordersInCountry.forEach((o) => {\n            o.OrderDate = new Date(o.OrderDate);\n            const key = o.OrderDate.getFullYear() + '/' + (o.OrderDate.getMonth() + 1);\n            accumulated[key] = accumulated[key] || {\n                value: 0,\n                orderDate: o.OrderDate\n            };\n            accumulated[key].value++;\n        });\n\n        return {\n            rows: ordersInCountry,\n            country,\n            accumulated\n        }\n\n    }).slice(0, 2)\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.orders = await prepareDataSource()\n}"},"property":"content","logged":true,"previousOperationId":"b0njou7416il2we","id":"itrsptkv29wu8gg","stack":"Error: require of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n  at sandboxRequire (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:64:19)\n  at Object.require (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n  at eval (sandbox.js:2:15)\n  at async run (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:214:14)\n  at async executeScript (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:129:12)\n  at async Scripts._runScript (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n  at async Scripts.handleBeforeRender (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n  at async ListenerCollection.fire (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n  at async beforeRender (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)\n  at async WorkerReporter._render (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:147:7)\n  at async /Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/jsreport-core/lib/worker/reporter.js:232:24\n  at async processAndResponse (/Users/eliezerrangel/jsreport-demo/node_modules/@jsreport/advanced-workers/lib/workerHandler.js:41:17)","message":"Error when evaluating custom script /samples/Orders/orders-script\nrequire of \"https\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"https\"] }\n\n(sandbox.js line 2:15)\n\n  1 | // server side script fetching remote data and preparing report data source\n> 2 | const https = require('https');\n    |               ^\n  3 |\n  4 | // call remote http rest api\n  5 | function fetchOrders() {\n\n"}
